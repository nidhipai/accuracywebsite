<div class="sat">

    <h2 class="calendar-title">Accuracy Calendar</h2>

    <div class="calendar-header">
        <a class="np" id="prev">Previous Month</a>
        <strong><div id="month-name"></div></strong>
        <a class="np" id="next">Next Month</a>
    </div>

    <br>

    <div class="calendar">

        <table>
            <tr class="day-names">
                <td>Sunday</td>
                <td>Monday</td>
                <td>Tuesday</td>
                <td>Wednesday</td>
                <td>Thursday</td>
                <td>Friday</td>
                <td>Saturday</td>
            </tr>

            <div class="dates">
                <tr>
                    <td id="row1col1">
                        <div id="11day"></div><br>
                        <div id="11events"></div>
                    </td>
                    <td id="row1col2">
                        <div id="12day"></div><br>
                        <div id="12events"></div>
                    </td>
                    <td id="row1col3">
                        <div id="13day"></div><br>
                        <div id="13events"></div>
                    </td>
                    <td id="row1col4">
                        <div id="14day"></div><br>
                        <div id="14events"></div>
                    </td>
                    <td id="row1col5">
                        <div id="15day"></div><br>
                        <div id="15events"></div>
                    </td>
                    <td id="row1col6">
                        <div id="16day"></div><br>
                        <div id="16events"></div>
                    </td>
                    <td id="row1col7">
                        <div id="17day"></div><br>
                        <div id="17events"></div>
                    </td>
                </tr>

                <tr>
                    <td id="row2col1">
                        <div id="21day"></div><br>
                        <div id="21events"></div>
                    </td>
                    <td id="row2col2">
                        <div id="22day"></div><br>
                        <div id="22events"></div>
                    </td>
                    <td id="row2col3">
                        <div id="23day"></div><br>
                        <div id="23events"></div>
                    </td>
                    <td id="row2col4">
                        <div id="24day"></div><br>
                        <div id="24events"></div>
                    </td>
                    <td id="row2col5">
                        <div id="25day"></div><br>
                        <div id="25events"></div>
                    </td>
                    <td id="row2col6">
                        <div id="26day"></div><br>
                        <div id="26events"></div>
                    </td>
                    <td id="row2col7">
                        <div id="27day"></div><br>
                        <div id="27events"></div>
                    </td>
                </tr>

                <tr>
                    <td id="row3col1">
                        <div id="31day"></div><br>
                        <div id="31events"></div>
                    </td>
                    <td id="row3col2">
                        <div id="32day"></div><br>
                        <div id="32events"></div>
                    </td>
                    <td id="row3col3">
                        <div id="33day"></div><br>
                        <div id="33events"></div>
                    </td>
                    <td id="row3col4">
                        <div id="34day"></div><br>
                        <div id="34events"></div>
                    </td>
                    <td id="row3col5">
                        <div id="35day"></div><br>
                        <div id="35events"></div>
                    </td>
                    <td id="row3col6">
                        <div id="36day"></div><br>
                        <div id="36events"></div>
                    </td>
                    <td id="row3col7">
                        <div id="37day"></div><br>
                        <div id="37events"></div>
                    </td>
                </tr>

                <tr>
                    <td id="row4col1">
                        <div id="41day"></div><br>
                        <div id="41events"></div>
                    </td>
                    <td id="row4col2">
                        <div id="42day"></div><br>
                        <div id="42events"></div>
                    </td>
                    <td id="row4col3">
                        <div id="43day"></div><br>
                        <div id="43events"></div>
                    </td>
                    <td id="row4col4">
                        <div id="44day"></div><br>
                        <div id="44events"></div>
                    </td>
                    <td id="row4col5">
                        <div id="45day"></div><br>
                        <div id="45events"></div>
                    </td>
                    <td id="row4col6">
                        <div id="46day"></div><br>
                        <div id="46events"></div>
                    </td>
                    <td id="row4col7">
                        <div id="47day"></div><br>
                        <div id="47events"></div>
                    </td>
                </tr>

                <tr>
                    <td id="row5col1">
                        <div id="51day"></div><br>
                        <div id="51events"></div>
                    </td>
                    <td id="row5col2">
                        <div id="52day"></div><br>
                        <div id="52events"></div>
                    </td>
                    <td id="row5col3">
                        <div id="53day"></div><br>
                        <div id="53events"></div>
                    </td>
                    <td id="row5col4">
                        <div id="54day"></div><br>
                        <div id="54events"></div>
                    </td>
                    <td id="row5col5">
                        <div id="55day"></div><br>
                        <div id="55events"></div>
                    </td>
                    <td id="row5col6">
                        <div id="56day"></div><br>
                        <div id="56events"></div>
                    </td>
                    <td id="row5col7">
                        <div id="57day"></div><br>
                        <div id="57events"></div>
                    </td>
                </tr>

                <tr>
                    <td id="row6col1">
                        <div id="61day"></div><br>
                        <div id="61events"></div>
                    </td>
                    <td id="row6col2">
                        <div id="62day"></div><br>
                        <div id="62events"></div>
                    </td>
                    <td id="row6col3">
                        <div id="63day"></div><br>
                        <div id="63events"></div>
                    </td>
                    <td id="row6col4">
                        <div id="64day"></div><br>
                        <div id="64events"></div>
                    </td>
                    <td id="row6col5">
                        <div id="65day"></div><br>
                        <div id="65events"></div>
                    </td>
                    <td id="row6col6">
                        <div id="66day"></div><br>
                        <div id="66events"></div>
                    </td>
                    <td id="row6col7">
                        <div id="67day"></div><br>
                        <div id="67events"></div>
                    </td>
                </tr>

            </div>
        </table>

        
    
    </div>

    <br>
    <div class="cal-msg">
        <p>To schedule an appointment, please visit the <a href="/contactus">Contact Us</a> page.</p>
    </div>

    <script>
        function numberCalendar(month, year) {
            var today = new Date(year, month, 1)
            var firstDayOfMonth = today.getDay() + 1;
            var lastDateOfMonth = new Date(today.getFullYear(), month + 1, 0)
            var lastDayOfMonth = lastDateOfMonth.getDay() + 1

            var cRow = 1
            var cCol = firstDayOfMonth

            for (i = 1; i < lastDateOfMonth.getDate() + 1; i++) {
                cCol = (firstDayOfMonth + i - 2) % 7 + 1
                var idHold = cRow + "" + cCol + "day"
                document.getElementById(idHold).innerHTML = i
                document.getElementById(idHold).style.float = "right"
                idHold = cRow + "" + cCol + "events"
                if (cCol === 7)
                    cRow++
            }

        }

        function formatTime(time) {
            var s = "" + ((time.getHours() + 11) % 12 + 1);
            if (time.getHours() >= 12)
                s += "PM"
            else
                s += "AM"
            return s
        }

        function populateEvents(events) {
            var cestart = new Date(events[0].estart)
            var offset = new Date(cestart.getFullYear(), cestart.getMonth(), 1).getDay();
            for (var x = 0; x < events.length; x++) {
                cestart = new Date(events[x].estart)
                var xTime = formatTime(cestart)
                var xName = events[x].eventname
                var row = 1 + Math.floor((cestart.getDate() + offset) / 7)
                var col = cestart.getDay() + 1;
                var idHold = "" + row + col + "events"
                console.log("idHold: " + idHold)
                document.getElementById(idHold).innerHTML += xTime + " - " + xName
                styleEvent(idHold)
            }
        }

        function styleEvent(idHold) {
            document.getElementById(idHold).style.backgroundColor = "#73a2ef"
            document.getElementById(idHold).style.fontSize = "14px"
        }

        function addMonthName(month, year) {
            var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            document.getElementById("month-name").innerHTML = monthNames[month] +  " " + year;
            styleHeader("month-name")
        }

        function styleHeader(monthHold) {
            document.getElementById("month-name").style.textAlign = "center"
        }

        function getEvents(month, year) {
            return fetch(`/api/events/${year}/${month}`).then(res => res.json())
        }
        //document.getElementById("test").innerHTML = idHold

        var prevMonthButton = document.getElementById("prev")
        var nextMonthButton = document.getElementById("next")

        function prevMonth() {
            if (month === 0) {
                year--
                month = 11
            }
            else {
                month--
            }
            processMonth(month, year)
        }

        function nextMonth() {
            if (month === 11) {
                year++
                month = 0
            } else {
                month++
            }
            processMonth(month, year)
        }

        var today = new Date()
        var month = today.getMonth();
        var year = today.getFullYear();
        processMonth(month, year)

        function clearCal() {
            for (var row = 1; row <= 6; row++) {
                for (var col = 1; col <= 7; col++) {
                    document.getElementById(`${row}${col}events`).innerHTML = "";
                    document.getElementById(`${row}${col}day`).innerHTML = "";
                }
            }
        }

        function processMonth(month, year) {
            clearCal();
            numberCalendar(month, year)
            addMonthName(month, year)
            fetch(`/api/events/${year}/${month + 1}`).then(res => res.json()).then(res => {
                console.log(res);
                populateEvents(res);
            }).catch(e => console.error(e));
        }


        nextMonthButton.addEventListener("click", nextMonth)
        prevMonthButton.addEventListener("click", prevMonth)
    </script>


</div>